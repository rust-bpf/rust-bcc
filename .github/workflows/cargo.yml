on: [push, pull_request]

env:
  CARGO_TERM_COLOR: always
  cache: 0

jobs:
  focal-llvm_9-bcc_v0_12_0:
    name: focal / llvm 9 / bcc 0.12.0
    runs-on: ubuntu-20.04
    env:
      BCC: "0.12.0"
      DIST: focal
      FEATURES: v0_12_0
      LLVM: "9"
      STATIC: true
    steps:
    - uses: actions/checkout@v2
    - name: BCC Build Cache
      uses: actions/cache@v2
      with:
        path: |
          ~/bcc
        key: ${{ runner.os }}-${{ env.LLVM }}-${{ env.BCC }}
    - name: Run CI
      run: bash -e build/ci.sh
  focal-llvm_9-bcc_v0_13_0:
    name: focal / llvm 9 / bcc 0.13.0
    runs-on: ubuntu-20.04
    env:
      BCC: "0.13.0"
      DIST: focal
      FEATURES: v0_13_0
      LLVM: "9"
      STATIC: true
    steps:
    - uses: actions/checkout@v2
    - name: BCC Build Cache
      uses: actions/cache@v2
      with:
        path: |
          ~/bcc
        key: ${{ runner.os }}-${{ env.LLVM }}-${{ env.BCC }}
    - name: Run CI
      run: bash -e build/ci.sh
  focal-llvm_9-bcc_v0_14_0:
    name: focal / llvm 9 / bcc 0.14.0
    runs-on: ubuntu-20.04
    env:
      BCC: "0.14.0"
      DIST: focal
      FEATURES: v0_14_0
      LLVM: "9"
      STATIC: true
    steps:
    - uses: actions/checkout@v2
    - name: BCC Build Cache
      uses: actions/cache@v2
      with:
        path: |
          ~/bcc
        key: ${{ runner.os }}-${{ env.LLVM }}-${{ env.BCC }}
    - name: Run CI
      run: bash -e build/ci.sh
  focal-llvm_9-bcc_v0_15_0:
    name: focal / llvm 9 / bcc 0.15.0
    runs-on: ubuntu-20.04
    env:
      BCC: "0.15.0"
      DIST: focal
      FEATURES: v0_15_0
      LLVM: "9"
      STATIC: true
    steps:
    - uses: actions/checkout@v2
    - name: BCC Build Cache
      uses: actions/cache@v2
      with:
        path: |
          ~/bcc
        key: ${{ runner.os }}-${{ env.LLVM }}-${{ env.BCC }}
    - name: Run CI
      run: bash -e build/ci.sh
  focal-llvm_9-bcc_v0_16_0:
    name: focal / llvm 9 / bcc 0.16.0
    runs-on: ubuntu-20.04
    env:
      BCC: "0.16.0"
      DIST: focal
      FEATURES: v0_16_0
      LLVM: "9"
      STATIC: true
    steps:
    - uses: actions/checkout@v2
    - name: BCC Build Cache
      uses: actions/cache@v2
      with:
        path: |
          ~/bcc
        key: ${{ runner.os }}-${{ env.LLVM }}-${{ env.BCC }}
    - name: Run CI
      run: bash -e build/ci.sh
  focal-llvm_9-bcc_v0_17_0:
    name: focal / llvm 9 / bcc 0.17.0
    runs-on: ubuntu-20.04
    env:
      BCC: "0.17.0"
      DIST: focal
      FEATURES: v0_17_0
      LLVM: "9"
      STATIC: true
    steps:
    - uses: actions/checkout@v2
    - name: BCC Build Cache
      uses: actions/cache@v2
      with:
        path: |
          ~/bcc
        key: ${{ runner.os }}-${{ env.LLVM }}-${{ env.BCC }}
    - name: Run CI
      run: bash -e build/ci.sh
  focal-llvm_9-bcc_v0_18_0:
    name: focal / llvm 9 / bcc 0.18.0
    runs-on: ubuntu-20.04
    env:
      BCC: "0.18.0"
      DIST: focal
      FEATURES: v0_18_0
      LLVM: "9"
      STATIC: true
    steps:
    - uses: actions/checkout@v2
    - name: BCC Build Cache
      uses: actions/cache@v2
      with:
        path: |
          ~/bcc
        key: ${{ runner.os }}-${{ env.LLVM }}-${{ env.BCC }}
    - name: Run CI
      run: bash -e build/ci.sh
  focal-llvm_9-bcc_v0_19_0:
    name: focal / llvm 9 / bcc 0.19.0
    runs-on: ubuntu-20.04
    env:
      BCC: "0.19.0"
      DIST: focal
      FEATURES: v0_19_0
      LLVM: "9"
      STATIC: true
    steps:
    - uses: actions/checkout@v2
    - name: BCC Build Cache
      uses: actions/cache@v2
      with:
        path: |
          ~/bcc
        key: ${{ runner.os }}-${{ env.LLVM }}-${{ env.BCC }}
    - name: Run CI
      run: bash -e build/ci.sh
  rustfmt:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: install rustfmt
      run: rustup component add rustfmt
    - name: rustfmt
      run: cargo fmt -- --check
  clippy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: install clippy
      run: rustup component add clippy
    - name: clippy
      run: cargo clippy || cargo clippy
